<% title("Events in calendar « #{@calendar.name} » for #{Date::MONTHNAMES[@start.month]} #{@start.year}") %>
<div class="row-fluid">
  <div class="span12">
    <table class="calendar">
      <tr>
        <% Date::DAYNAMES[0..-1].each do |day|%>
          <th><%= day %></th>
        <% end %>
      </tr>
      <% @month.weeks.each do |week| %>
        <tr class="week-days-number">
          <% week.days.each do |day| %>
            <td class="<% other_month_class(week, week.days.index(day), @month) %><%= if day.start.today? then 'today' else 'not-today' end %>">
            <div class="nav nav-pills">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= day.number %> <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><%= link_to("New event", new_event_path(:event => {:calendar_id => @calendar.id})) %></li>
                  <li><%= link_to("New full-day event", new_event_path(:event => {:calendar_id => @calendar.id, :start => "#{day.start.year}-#{day.start.month}-#{day.number} 00:00", :stop => "#{day.start.year}-#{day.start.month}-#{day.number} 23:59"})) %></li>
                  <li class="divider"></li>
                  <li><%= link_to("New event from this date", "#") %></li>
                  <li class="disabled"><%= link_to("New event to this date", "#") %></li>
                </ul>
              </li>
            </div>
            </td>
          <% end %>
        </tr>
        <% week.lines.each do |line| %>
          <tr class="week-events">
            <% line.each do |h| %>
              <td class="<% other_month_class(week, h[:day], @month) %><%= if week.start.advance(:days => h[:day]).today? then 'today' else 'not-today' end %>" <% if h[:event].nil? then %><% rowspan(h[:rowspan]) %><% else %><% colspan(h[:colspan]) %><% end %>>
                <% if !h[:event].nil? %>
                  <a href="<%= event_path(h[:event]) %>" class="event <%= if h[:event].start < week.start then "continued" end %> <%= if h[:event].stop > week.stop then "continue" end %> <%= if h[:event].multi_day? then "multi-day" end %>" style="background-color: <%= h[:event].calendar.color %>">
                    <% if !h[:event].full_day? then %>
                      <% if h[:event].multi_day? then %>
                        <% if h[:event].starts_this_week?(week) %>
                          <div class="start-hour"><%= h[:event].start.strftime("%H:%M") %></div>
                        <% end %>
                        <% if h[:event].stops_this_week?(week) %>
                          <div class="stop-hour"><%= h[:event].stop.strftime("%H:%M") %></div>
                        <% end %>
                      <% else %>
                        <%= h[:event].start.strftime("%H:%M") %> - <%= h[:event].stop.strftime("%H:%M") %><br />
                      <% end %>
                    <% end %>
                    <%= h[:event].title %>
                  </a>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      <% end %>
    </table>
  </div>
</div>
