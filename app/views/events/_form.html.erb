<%= form_for(@event, :html => {:class => "validatable form-horizontal"}) do |f| %>
  <%= f.error_messages %>
  <div class="control-group">
    <%= f.label :calendar_id, :class => "control-label" %>
    <div class="controls">
      <%= f.hidden_field(:calendar_id) %>
      <div class="btn-group">
        <a href="" class="btn dropdown-toggle" data-toggle="dropdown"><span id="calendar_selected_parent_name"><%= @event.calendar.name %></span> <i class="icon-caret-down"></i></a>
        <ul class="dropdown-menu" data-for="event_calendar_id">
          <% render_list(Calendar.arrange, :sort => lambda { |x| x.name } ) do |node| %>
            <%= content_tag(:li, :class =>  (node.id == @event.calendar_id) ? "active" : "" ) do %>
              <%= link_to((content_tag(:i, "", :class => "icon-angle-right") * node.level + node.name).html_safe, "#", :class => "calendar_combo_item", :data => { :value => node.id }) %>
            <% end %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :title, :class => "control-label" %>
    <div class="controls">
      <%= f.text_field :title, :class => 'required text_field input-xlarge' %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :body, :class => "control-label" %>
    <div class="controls">
      <%= f.text_area :body, :rows => 6, :class => "input-xlarge" %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :start, :class => "control-label" %>
    <div class="controls">
      <%= bootstrap_datepicker_tag(:start_date, @event.start) %>
      <%= bootstrap_timepicker_tag(:start_time, @event.start) %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :stop, :class => "control-label" %>
    <div class="controls">
      <%= bootstrap_datepicker_tag(:stop_date, @event.stop) %>
      <%= bootstrap_timepicker_tag(:stop_time, @event.stop) %>
    </div>
  </div>
  <% if @event.recurrence then %>
    <div class="control-group">
      <%= f.label :update, :class => "control-label" %>
      <div class="controls">
        <%= radio_button_tag "apply", "one", :checked => true %> <%= label_tag(:apply_one, "Only this occurence") %><br />
        <%= radio_button_tag "apply", "next" %> <%= label_tag(:apply_next, "This occurence and all the following") %><br />
        <%= radio_button_tag "apply", "all" %> <%= label_tag(:apply_all, "All occurences") %><br />
      </div>
    </div>
  <% end %>
  <div class="form-actions">
    <%= f.submit(:class => "btn btn-primary") %>
    <%- if !@event.new_record? then -%>
      <%= link_to(content_tag(:i, "", :class => "icon-trash") + " Delete Event", event_path(@event), :method => :delete, :confirm => "Really delete this Event?", :class => "btn btn-danger") %>
    <%- end -%>
    <%= link_to("Back", :back, :class => "btn") %>
  </div>
<% end %>
